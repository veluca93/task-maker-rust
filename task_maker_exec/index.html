<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="DAG execution dispatching the tasks to the workers."><title>task_maker_exec - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-ba5701c5741a7b69.css" id="mainThemeStyle"><div id="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="task_maker_exec" data-themes="" data-resource-suffix="" data-rustdoc-version="1.70.0 (90c541806 2023-05-31)" data-search-js="search-e077946657036a58.js" data-settings-js="settings-298e1ea74db45b39.js" data-settings-css="settings-7bfb4c59cc6bc502.css" data-theme-light-css="light-0f8c037637f9eb3e.css" data-theme-dark-css="dark-1097f8e92a01e3cf.css" data-theme-ayu-css="ayu-614652228113ac93.css" ></div><script src="../static.files/storage-62ce34ea385b278a.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-f61008743c98d196.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../static.files/light-0f8c037637f9eb3e.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../static.files/dark-1097f8e92a01e3cf.css"><link rel="stylesheet" href="../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../task_maker_exec/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../task_maker_exec/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Crate task_maker_exec</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.5.13</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">task_maker_exec</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/task_maker_exec/lib.rs.html#1-253">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>DAG execution dispatching the tasks to the workers.</p>
<p>This crate is able to setup a distributed execution environment by creating an <code>Executor</code> which
spawns some workers, and a client which, talking to the executor, is able to schedule the
execution of a DAG.</p>
<p>A <a href="../task_maker_store/struct.FileStore.html"><code>FileStore</code></a> is used to store the files of the DAG
and <a href="https://doc.rust-lang.org/std/sync/mpsc/fn.channel.html"><code>std::sync::mpsc::channel</code></a> is
used for the internal communication.</p>
<p>A simple <code>Scheduler</code> is used to dispatch the jobs when all their dependencies are ready. When an
execution is not successful (i.e. does not return with zero) all the depending jobs are
cancelled.</p>
<p>All the tasks are run inside a <a href="struct.Sandbox.html"><code>Sandbox</code></a> provided by
<a href="https://crates.io/crates/tabox"><code>tabox</code></a>.</p>
<h3 id="implementation-details"><a href="#implementation-details">Implementation details</a></h3>
<p>In order to support both local and remote evaluation, sharing the same code and logic we need a
layer of abstraction over the execution.</p>
<p>The components of the execution are:</p>
<ul>
<li><a href="struct.ExecutorClient.html"><code>ExecutorClient</code></a> (from now <code>Client</code>) is the component that runs
on the process that wants to execute the DAG, it asks to its executor to run it and gets the
results eventually processing them.</li>
<li><a href="executors/struct.LocalExecutor.html"><code>LocalExecutor</code></a> the component to which the <code>Client</code>
connects to for executing a DAG locally, it internally uses an <code>Executor</code> for actually running
the DAG, but also spawns local workers.</li>
<li><a href="executors/struct.RemoteExecutor.html"><code>RemoteExecutor</code></a> the component to which the <code>Client</code>
connects to for executing a DAG remotely. This usually runs on a remote machine w.r.t the
client’s one. It internally uses an <code>Executor</code> for running the DAG but doesn’t spawn the
workers since they are remote too. This component is also responsible for listening to the
sockets for the connections of the clients and the workers.</li>
<li><code>Executor</code> the component that abstracts the connection of workers and clients and handles the
actual communication between the scheduler and the clients. This component is also responsible
for spawning the scheduler and keeping it working.</li>
<li><code>Scheduler</code> the component that, given DAGs and notification about the status of the workers
(i.e. worker connection/disconnection/job completion) schedules the execution of the ready
jobs and sends to the clients the notification about their status.</li>
<li><code>WorkerManager</code> the component that handles the connections with the workers and notifies the
scheduler about worker events.</li>
<li><code>Worker</code> the component that actively asks for work to do, waiting a response from the
scheduler, and eventually receive and execute it. After the execution completes, the worker
asks for another job to do.</li>
</ul>
<h4 id="local-execution"><a href="#local-execution">Local execution</a></h4>
<p><img src="https://www.lucidchart.com/publicSegments/view/f0ad0719-2dd4-4c60-9da0-ca0614fd37a1/image.png" alt="Local execution diagram" /></p>
<p>Running locally all the components are spawn in the current process, but different threads.
The communication between them is done using in memory channels, including the one from the
<code>Client</code> to the <code>LocalExecutor</code>.</p>
<p>The <code>Client</code> connects to the <code>LocalExecutor</code>, specifying also the number of workers to spawn.
The local executor spawns an actual executor, a worker manager and that number of workers.</p>
<h4 id="remote-execution"><a href="#remote-execution">Remote execution</a></h4>
<p><img src="https://www.lucidchart.com/publicSegments/view/86167d8f-b231-4698-a8ac-a26ed995fd19/image.png" alt="Local execution diagram" /></p>
<p>In a remote environment the <code>Client</code> connects to the <code>RemoteExecutor</code> via a TCP socket, the
remote executor listens for client and worker connections. The workers then connect to the
<code>RemoteExecutor</code> and they are handled by the <code>WorkerManager</code>.</p>
</div></details><h2 id="reexports" class="small-section-header"><a href="#reexports">Re-exports</a></h2><ul class="item-table"><li><div class="item-name" id="reexport.ductile"><code>pub use ductile;</code></div></li><li><div class="item-name" id="reexport.RawSandboxResult"><code>pub use sandbox::<a class="enum" href="sandbox/enum.RawSandboxResult.html" title="enum task_maker_exec::sandbox::RawSandboxResult">RawSandboxResult</a>;</code></div></li></ul><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="executors/index.html" title="mod task_maker_exec::executors">executors</a></div><div class="desc docblock-short">The supported executors.</div></li><li><div class="item-name"><a class="mod" href="find_tools/index.html" title="mod task_maker_exec::find_tools">find_tools</a></div><div class="desc docblock-short">Finds the location of the <code>task-maker-tools</code> executable.</div></li><li><div class="item-name"><a class="mod" href="proto/index.html" title="mod task_maker_exec::proto">proto</a></div><div class="desc docblock-short">The protocol related structs and enums.</div></li><li><div class="item-name"><a class="mod" href="sandbox/index.html" title="mod task_maker_exec::sandbox">sandbox</a></div><div class="desc docblock-short">This mod contains the sandbox-related code. It interfaces with tabox creating the sandbox setup
(directories and configuration) for an execution.</div></li></ul><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.ClientInfo.html" title="struct task_maker_exec::ClientInfo">ClientInfo</a></div><div class="desc docblock-short">Information about a client of the scheduler.</div></li><li><div class="item-name"><a class="struct" href="struct.ErrorSandboxRunner.html" title="struct task_maker_exec::ErrorSandboxRunner">ErrorSandboxRunner</a></div><div class="desc docblock-short">A fake sandbox that don’t actually spawn anything and always return an error.</div></li><li><div class="item-name"><a class="struct" href="struct.ExecutorClient.html" title="struct task_maker_exec::ExecutorClient">ExecutorClient</a></div><div class="desc docblock-short">This is a client of the <code>Executor</code>, the client is who sends a DAG for an evaluation, provides
some files and receives the callbacks from the server. When the server notifies a callback
function is called by the client.</div></li><li><div class="item-name"><a class="struct" href="struct.ExecutorStatus.html" title="struct task_maker_exec::ExecutorStatus">ExecutorStatus</a></div><div class="desc docblock-short">The current status of the <code>Executor</code>, this is sent to the user when the server status is asked.</div></li><li><div class="item-name"><a class="struct" href="struct.ExecutorWorkerStatus.html" title="struct task_maker_exec::ExecutorWorkerStatus">ExecutorWorkerStatus</a></div><div class="desc docblock-short">Status of a worker of an <code>Executor</code>.</div></li><li><div class="item-name"><a class="struct" href="struct.SuccessSandboxRunner.html" title="struct task_maker_exec::SuccessSandboxRunner">SuccessSandboxRunner</a></div><div class="desc docblock-short">A fake sandbox that don’t actually spawn anything and always return successfully with exit code
0.</div></li><li><div class="item-name"><a class="struct" href="struct.Worker.html" title="struct task_maker_exec::Worker">Worker</a></div><div class="desc docblock-short">The worker is the component that receives the work from the server and sends the results back.
It computes the results by executing a process inside a sandbox, limiting the available
resources and measuring the used ones.</div></li><li><div class="item-name"><a class="struct" href="struct.WorkerConn.html" title="struct task_maker_exec::WorkerConn">WorkerConn</a></div><div class="desc docblock-short">An handle of the connection to the worker.</div></li><li><div class="item-name"><a class="struct" href="struct.WorkerCurrentJobStatus.html" title="struct task_maker_exec::WorkerCurrentJobStatus">WorkerCurrentJobStatus</a></div><div class="desc docblock-short">Information about the job the worker is currently doing.</div></li></ul><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.SandboxRunner.html" title="trait task_maker_exec::SandboxRunner">SandboxRunner</a></div><div class="desc docblock-short">Something able to spawn a sandbox, wait for it to exit and return the results.</div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.derive_key_from_password.html" title="fn task_maker_exec::derive_key_from_password">derive_key_from_password</a></div><div class="desc docblock-short">Derive the encryption key from a password string.</div></li><li><div class="item-name"><a class="fn" href="fn.eval_dag_locally.html" title="fn task_maker_exec::eval_dag_locally">eval_dag_locally</a></div><div class="desc docblock-short">Evaluate a DAG locally spawning a new <a href="executors/struct.LocalExecutor.html"><code>LocalExecutor</code></a>
with the specified number of workers.</div></li></ul></section></div></main></body></html>